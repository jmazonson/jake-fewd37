<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">

    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      width: 960px;
      height: 500px;
      position: relative;
    }

    svg {
      width: 100%;
      height: 100%;
    }
    path.slice{
      stroke-width:2px;
    }
    path.labelArc{
      stroke-width:2px;
    }
    polyline{
      stroke-width:1px;
    }

    </style>
  </head>
  <body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script type="text/javascript">
  function drawDeductibleTracker(width,height,spendToDate,deductible,coinsurance){
    //size SVG append to dom
      //create svg element
      var svg = d3.select("body")
      	.append("svg")
        .attr({width:width,height:height})
        .append("g")
        //Note, just doing the slices for now
        svg.append("g")
        	.attr("class", "slices");
        svg.append("g")
          .attr("class", "labelArcs");
        svg.append("g")
        	.attr("class", "labelLines");
        svg.append("g")
          .attr("class", "labelText");
        svg.append("g")
          .attr("class", "labelTicks");

      //centering the svg
      svg.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

      //variables for pie chart-------------//
      // The pie layout is a convenience for computing the start and end angles of arcs that comprise a pie or donut chart:
      var radius = Math.min(width, height) / 2;
      var graphStartAngle = -135;
      var pie = d3.layout.pie()
        //disables sorting (not sure why) the order of the arcs will be the same as what I pass in
        .sort(null)
        .startAngle(graphStartAngle*(Math.PI/180))
        .endAngle(90*(Math.PI/180))
        //Specifies how to extract a value from the associated data might also give data that determines the size of the pie
        .value(function(d) {
          return d.value;
        });

      var key = function(d){ return d.data.section; };
//---------------------Creating the Arcs-----------------------//
      var deductiblePadding = 0.1;
      var labelRadiusAdjust = .9;
      // this is where I set the length of the tick mark
      var tickRadiusAdjust = 0.85;

      //creating arc for the slices
      var arc = d3.svg.arc()
        .outerRadius(radius * 0.8)
        .innerRadius(radius * 0.6)
        // set the padding between deductible and coinsurance
        .padAngle(function(d) {
          if (key(d)=="coinsurance") {
            return deductiblePadding;
          };
          return 0;
        });

      //arc points for tick marks
      var tickArc = d3.svg.arc()
        .innerRadius(radius * tickRadiusAdjust)
        .outerRadius(radius * labelRadiusAdjust)
        .padAngle(function(d) {
          if (key(d)=="coinsurance") {
            return deductiblePadding;
          };
          return 0;
        });

      //creating outer arc for the labelArcs
      var labelArc = d3.svg.arc()
        .innerRadius(radius * labelRadiusAdjust)
        .outerRadius(radius * labelRadiusAdjust)
        .padAngle(function(d) {
          if (key(d)=="coinsurance") {
            return deductiblePadding;
          };
          return 0;
        });


     ///---------------- Start the data dicing ------------------///
      var theSliceData =[
        { "section": 'spendToDate', "value": spendToDate, "color" : "#275089"},
        { "section": 'deductibleBar', "value": deductible-spendToDate, "color" : "#D5D5D5"},
        // { "section": 'deductibleBreak', "value": 80, "color" : "white"},
        { "section": 'coinsurance', "value": coinsurance, "color" : "#D5D5D5"},
        ];

      var theLabelData =[
        { "section": 'deductibleLabel', "value": deductible, "color" : "#F17F19", label: "Deductible"},
        { "section": 'coinsurance', "value": coinsurance, "color" : "#56BFDD", label: "Coinsurance"},
        ];

      // var theTickData = [
      //   { "section": 'deductibleStartAngle', "value": deductible, "color" : "#F17F19", label: "Deductible"},
      //   { "section": 'deductibleEndAngle', "value": deductible, "color" : "#F17F19", label: "Deductible"},
      //   { "section": 'coinsuranceStartAngle', "value": coinsurance, "color" : "#56BFDD", label: "Coinsurance"},
      //   { "section": 'coinsuranceEndAngle', "value": coinsurance, "color" : "#56BFDD", label: "Coinsurance"},
      //   ];


      /* ------- Draw the PIE SLICES -------*/
      // a slice is = all the objects in the slice group which at this point is probably empty
      var slice = svg.select(".slices")
        .selectAll("path.slice")
        // for each element in data get the start and end angles of that slice.
        //
        .data(pie(theSliceData), key);
      //returns place holders for missing elements enter is for all the new data enter represents the new elements
      //selecting new
      slice.enter()
        // I think insert is like append except it puts it above in the dom rather than under
        // path is the type of element im creating
        .insert("path")
        // make the fill the color associated with that element of the data set
        .style("fill", function(d) { return d.data.color; })
        // make the path be slice
        .attr("class", "slice");

      slice.attr("d",function(d) {
        return arc(d)
      })


      /* ------- Draw the label Arcs -------*/
      var slice = svg.select(".labelArcs")
        .selectAll("path.labelArc")
        // for each element in data get the start and end angles of that slice.
        //
        .data(pie(theLabelData), key);
      //returns place holders for missing elements enter is for all the new data enter represents the new elements
      //selecting new
      slice.enter()
        // I think insert is like append except it puts it above in the dom rather than under
        // path is the type of element im creating
        .insert("path")
        // make the fill the color associated with that element of the data set
        .style("stroke", function(d) { return d.data.color; })
        // make the path be slice class
        .attr("class", "labelArcs");
        // set the draw atribute to what the label arc function returns
      slice.attr("d",function(d) {
        //labelArc(d));
        return labelArc(d)
      })

      /* ------- Draw the label text -------*/
      var text = svg.select(".labelText")
        .selectAll("text")
        .data(pie(theLabelData), key);

      text.enter()
    		.append("text")
    		.attr("dy", ".35em")
    		.text(function(d) {
    			return d.data.label;
    		});
      //define function to get the midAngle of slice
      function midAngle(d){
    		return d.startAngle + (d.endAngle - d.startAngle)/2;
    	}
      text.attr("transform",function(d) {
        pos = labelArc.centroid(d);
        pos[0] = radius * (midAngle(d) > (0) ? 1 : -1);
        return "translate("+ pos +")";
      })
      .style("text-anchor", function(d){
        return midAngle(d) > 0 ? "start":"end";
      })



      /* ------- Draw the label TICKS -------*/

      var deductibleStartAngle = slice.data()[0]["startAngle"];
      var deductibleEndAngle = slice.data()[0]["endAngle"];
      //var deductibleStartAngle = 0;


      function getTickPointsV2(data){
        var curveInfoString = tickArc(data);
        //split string at commas into an array
        var newString=curveInfoString.split(",")
        //take the m off of the first entry
        xy = [newString[0].slice(1),newString[1]]
        for (var i = 0; i < xy.length; i++) {
          xy[i]=parseFloat(xy[i])
        }


        //

        return xy;
      }

      function getTickPoints(theta){
        var Pos = [Math.cos(theta)*(radius * labelRadiusAdjust),
                   Math.sin(theta)*(radius * labelRadiusAdjust),
                   Math.cos(theta)*(radius * tickRadiusAdjust),
                   Math.sin(theta)*(radius * tickRadiusAdjust)]

        return Pos;
      }
      var ticks = svg.select(".labelTicks").selectAll("polyilne")
        .data(pie(theLabelData), key);
      ticks.enter()
        .append("polyline")
        .style("stroke", function(d) { return d.data.color; })
      ticks.attr("points", function (d) {
        console.log(getTickPointsV2(d));
        })
        // .attr("points", function (d) {
        //   console.log(d);
        //   console.log("drawing end tick");
        //   debugger;
        //   return getTickPoints(d["endAngle"]);
        //   })
  }



  drawDeductibleTracker(520,360,550,1750,3700);



  </script>
  </body>
</html>



<!-- ///////
This is what I get
labelArc(d)
"M-114.55129855222073,114.55129855222069A162,162 0 0,1 -144.02374608968884,-74.16980896761729L-144.02374608968884,-74.16980896761729A162,162 0 0,0 -114.55129855222073,114.55129855222069Z"
getTickPoints(d["startAngle"]*-1);
This is what I want
[-114.55129855222069, 114.5512985522207, -108.18733752154176, 108.18733752154178]
This is how I get it

string
["M-114.55129855222073", "114.55129855222069A162", "162 0 0", "1 -144.02374608968884", "-74.16980896761729L-144.02374608968884", "-74.16980896761729A162", "162 0 0", "0 -114.55129855222073", "114.55129855222069Z"]
string = string.slice(1)
["114.55129855222069A162", "162 0 0", "1 -144.02374608968884", "-74.16980896761729L-144.02374608968884", "-74.16980896761729A162", "162 0 0", "0 -114.55129855222073", "114.55129855222069Z"]
string
["114.55129855222069A162", "162 0 0", "1 -144.02374608968884", "-74.16980896761729L-144.02374608968884", "-74.16980896761729A162", "162 0 0", "0 -114.55129855222073", "114.55129855222069Z"]
string.type
undefined
string.type()
VM1559:1 Uncaught TypeError: string.type is not a function(â€¦)(anonymous function) @ VM1559:1InjectedScript._evaluateOn @ VM903:875InjectedScript._evaluateAndWrap @ VM903:808InjectedScript.evaluateOnCallFrame @ VM903:933(anonymous function) @ index.html:212a @ d3.v3.min.js:1(anonymous function) @ d3.v3.min.js:3Y @ d3.v3.min.js:1Aa.each @ d3.v3.min.js:3Aa.attr @ d3.v3.min.js:3drawDeductibleTracker @ index.html:210(anonymous function) @ index.html:224
string
["114.55129855222069A162", "162 0 0", "1 -144.02374608968884", "-74.16980896761729L-144.02374608968884", "-74.16980896761729A162", "162 0 0", "0 -114.55129855222073", "114.55129855222069Z"]
xy = string[0]
"114.55129855222069A162"
xy
"114.55129855222069A162"
xy = [xy]
["114.55129855222069A162"]
string
["114.55129855222069A162", "162 0 0", "1 -144.02374608968884", "-74.16980896761729L-144.02374608968884", "-74.16980896761729A162", "162 0 0", "0 -114.55129855222073", "114.55129855222069Z"]
string[2]
"1 -144.02374608968884"
string[2].split(" ")
["1", "-144.02374608968884"]
xy[1] = string[2].split(" ")[1]
"-144.02374608968884"
xy
["114.55129855222069A162", "-144.02374608968884"]
-->
